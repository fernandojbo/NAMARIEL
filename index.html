<!-- Vers√£o Profissional do Painel CT-e para GitHub Pages -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel CT-e ‚Ä¢ Vers√£o Profissional</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<style>
body {margin:0;font-family:Inter, sans-serif;background:#f0f2f5;color:#222;}
header {background:#004d40;color:white;padding:20px 30px;font-size:22px;font-weight:700;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
.container {padding:25px;max-width:1600px;margin:auto;}
.card {background:white;border-radius:14px;padding:20px;box-shadow:0 4px 10px rgba(0,0,0,0.08);} 
.grid {display:grid;gap:20px;} 
.grid-3 {grid-template-columns:repeat(auto-fit,minmax(250px,1fr));}
label {font-size:14px;font-weight:600;}
input[type=file] {margin-top:10px;}
#charts {margin-top:30px;}
.table-wrap {overflow-x:auto;margin-top:25px;}
table {width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden;background:white;box-shadow:0 4px 10px rgba(0,0,0,0.08);} 
th, td {padding:10px 12px;border-bottom:1px solid #ddd;font-size:14px;} 
th {background:#00695c;color:white;text-align:left;font-weight:600;position:sticky;top:0;z-index:1;} 
.status {padding:5px 10px;border-radius:20px;font-size:12px;font-weight:700;} 
.status-Atrasado {background:#ffebee;color:#c62828;} 
.status-Em-Risco {background:#fff8e1;color:#f9a825;} 
.status-Normal {background:#e8f5e9;color:#2e7d32;} 
.sidebar {background:white;padding:20px;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.1);} 
button {cursor:pointer;border:0;padding:10px 16px;border-radius:8px;font-size:14px;font-weight:600;} 
.btn-primary {background:#00695c;color:white;} 
.btn-primary:hover {background:#005249;} 
.filter-btn {background:#e0f2f1;color:#004d40;margin:4px;} 
.filter-btn.active {background:#004d40;color:white;} 
</style>
</head>
<body>
<header>Painel Profissional ‚Ä¢ An√°lise de CT-e (24h)</header>
<div class="container grid" style="grid-template-columns:260px 1fr;align-items:flex-start;">
<div class="sidebar">
<h3>üìÇ Importar CSV</h3>
<input type="file" id="csv-file" accept=".csv"><br><br>
<p id="file-status" style="font-size:14px;color:#333;"></p>
<hr>
<h3>üóÇÔ∏è Filtros</h3>
<div id="filter-area"></div>
</div>
<div>
<div class="grid grid-3" id="kpi-area"></div>
<div id="charts" class="grid" style="grid-template-columns:1fr 1fr;">
<div class="card"><canvas id="chartAtrasos"></canvas></div>
<div class="card"><canvas id="chartCentral"></canvas></div>
</div>
<div class="table-wrap">
<table id="ct-table">
<thead>
<tr>
<th>Status</th><th>CT-e</th><th>NF</th><th>Destino</th><th>Centralizadora</th><th>Pagador</th><th>Vol.</th><th>Emiss√£o</th><th>√ölt Ocorr√™ncia</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
</div>
<script>
let allData=[]; let currentFilter="Todos";
const CENTRALIZERS_MAP={ 'BVB':'BEL','HCT':'BEL','MAO':'BEL','MFL':'BEL','OCA':'BEL','THT':'BEL','TNE':'BEL','WST':'BEL','FRC':'CBA','ALF':'CBI','COL':'CBI','CPV':'CBI','GUA':'CBI','HRA':'CBI','HRT':'CBI','JUI':'CBI','LRV':'CBI','NMT':'CBI','PRI':'CBI','PRL':'CBI','RCE':'CBI','RDM':'CBI','RED':'CBI','STS':'CBI','TAG':'CBI','TIM':'CBI','TLT':'CBI','TNN':'CBI','APT':'CGR','BLU':'CPQ','JOI':'CPQ','LDN':'CPQ','SPO':'CPQ','STO':'CPQ','ANP':'GYN','APS':'GYN','BPG':'GYN','CHS':'GYN','CLA':'GYN','CRA':'GYN','DBS':'GYN','PCA':'GYN','PCK':'GYN','PCX':'GYN','VIP':'GYN','ALT':'MAB','NRE':'MAB','PAC':'MAB','PEB':'MAB','SFX':'MAB','TAL':'MAB','TUC':'MAB','XIG':'MAB','BIV':'NBL','CAP':'NBL','CMT':'NBL','CPO':'NBL','MAC':'NBL','MAU':'NBL','MCP':'NBL','MDR':'NBL','PRG':'NBL','SIQ':'NBL','SRT':'NBL','WFT':'NBL','AAC':'ROO','AL2':'TRU','CEC':'TRU','CW3':'TRU','EGO':'TRU','INV':'TRU','LCE':'TRU','LUZ':'TRU','NWF':'TRU','RAD':'TRU','RIT':'TRU','SPR':'TRU','TNG':'TRU','USE':'TRU','VAL':'TRU','PAT':'UDI'};
function parse(d){if(!d)return null;d=d.split(' ')[0];let m=d.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(m){let js=new Date(`${m[2]}/${m[1]}/${m[3]}`);if(!isNaN(js))return js.setHours(0,0,0,0);}return null;}
document.getElementById('csv-file').addEventListener('change',e=>{Papa.parse(e.target.files[0],{header:true,complete:r=>process(r.data)});});
function process(d){const hoje=new Date();hoje.setHours(0,0,0,0);const h=hoje.getTime();allData=d.map(r=>{let item={ct:r['CTRC/GAI/PAL'],nf:r['NFISCAL'],dest:r['DESTINO'],pag:r['PAGADOR'],vol:r['QVOL'],ult:r['DATA ULT OCOR'],emi:r['DATA EMISS√ÉO']};item.central=CENTRALIZERS_MAP[item.dest]||item.dest;item.ultTS=parse(item.ult);let diff=item.ultTS?Math.floor((h-item.ultTS)/86400000):-1;item.status=diff>=2?'Atrasado':diff===1?'Em Risco':'Normal';return item;});render();}
function render(){renderKPI();renderFilters();renderCharts();renderTable();}
function renderKPI(){let a=allData.filter(x=>x.status==='Atrasado').length,r=allData.filter(x=>x.status==='Em Risco').length,n=allData.filter(x=>x.status==='Normal').length;document.getElementById('kpi-area').innerHTML=`
<div class='card'><h3>Total</h3><p style='font-size:32px;font-weight:700'>${allData.length}</p></div>
<div class='card'><h3>Atrasados</h3><p class='status-Atrasado' style='font-size:28px;'>${a}</p></div>
<div class='card'><h3>Em Risco</h3><p class='status-Em-Risco' style='font-size:28px;'>${r}</p></div>
<div class='card'><h3>No Prazo</h3><p class='status-Normal' style='font-size:28px;'>${n}</p></div>`;}
function renderFilters(){let areas=[...new Set(allData.map(x=>x.central))].sort();let html=`<button class='filter-btn ${currentFilter==='Todos'?'active':''}' onclick='setFilter("Todos")'>Todos</button>`;areas.forEach(c=>{html+=`<button class='filter-btn ${currentFilter===c?'active':''}' onclick='setFilter("${c}")'>${c}</button>`});document.getElementById('filter-area').innerHTML=html;} 
function setFilter(f){currentFilter=f;renderTable();render();}
let chart1,chart2;
function renderCharts(){let atras=allData.filter(x=>x.status==='Atrasado').length;let risco=allData.filter(x=>x.status==='Em Risco').length;let norm=allData.filter(x=>x.status==='Normal').length;if(chart1)chart1.destroy();chart1=new Chart(document.getElementById('chartAtrasos'),{type:'pie',data:{labels:['Atrasado','Em Risco','Normal'],datasets:[{data:[atras,risco,norm]}]}});
let cent={};allData.forEach(x=>{cent[x.central]=(cent[x.central]||0)+1});if(chart2)chart2.destroy();chart2=new Chart(document.getElementById('chartCentral'),{type:'bar',data:{labels:Object.keys(cent),datasets:[{data:Object.values(cent)}]}});
}
function renderTable(){let data=currentFilter==='Todos'?allData:allData.filter(x=>x.central===currentFilter);let tb=document.querySelector('#ct-table tbody');tb.innerHTML='';data.forEach(x=>{tb.innerHTML+=`<tr><td><span class='status status-${x.status.replace(/ /g,'-')}'>${x.status}</span></td><td>${x.ct||''}</td><td>${x.nf||''}</td><td>${x.dest||''}</td><td>${x.central}</td><td>${x.pag||''}</td><td>${x.vol||''}</td><td>${x.emi||''}</td><td>${x.ult||''}</td></tr>`;});}
</script>
</body>
</html>
